{% extends 'flatpages/default.html' %}
{% load custom_filters %}
{% load custom_tags %}


{% block body %}


<h1>Список заказов</h1>

<table  border="1">
    <tr>
<th>{{ filterset.form.time_in.label }}</th>
<th>{{ filterset.form.address_city.label }} | {{ filterset.form.address_street_app.label }}</th>
<th>{{ filterset.form.repairer_id.label }}</th>
<th>Стоимость</th>

</tr>

    <tr>
<form action="" method="get">
<td>{{ filterset.form.time_in }} | {{ filterset.form.time_out }}</td>
<td>{{ filterset.form.address_city }} | {{ filterset.form.address_street_app }}</td>
<td>{{ filterset.form.repairer_id }}</td>
<td></td>

<td><input type="submit" value="Найти" /></td>

</form>
</tr>

{% regroup order by time_in|date:"d.m.Y" as day %}

    {% for y in day %}
    <tr>
        <td  colspan="6">
            <b>{{ y.grouper }}</b>
        </td>
    <tr>

        {% for i in y.list %}
        <tr>
            <td>
            <a href="list_order/{{i.pk }}">Заказа №{{ i.pk}}</a>{{ i.time_out | finish_order_tag }}<br>
            {{ i.address_city | choice_tag:'city' }}, {{ i.address_street_app }}, {{ i.address_num }}</td>

            <td>{{ i.repairer_id }}</td>
            <td>{{ i.text_order|truncatewords:7 }}</td>
            <td>{{ i.price }}</td>
            <td>{% for d in i.services.all %} {{ d }}<br>{% endfor %}</td>
            <td>
                {% if request.user.is_authenticated %}
                <a href="list_order/delete/{{ i.pk }}">Удалить</a> | <a href="list_order/update/{{ i.pk }}">Изменить</a></td>
                {% endif %}
            </tr>

        {% endfor %}
    {% endfor %}
</table>





{% endblock body %}
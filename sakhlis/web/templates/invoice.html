{% extends 'flatpages/default_user.html' %}
{% load custom_filters %}
{% load custom_tags %}

{% block body %}

<style>
    .hidden{
    display:none
    }

</style>

<div class="container">
    <div class="row">
        <div class="col-md-12" align="center">
        {% if prev.pk %}
            <a href="{% url 'invoice' prev.pk %}" class="btn"><</a>
        {% endif %}
        {% if next.pk %}
            <a href="{% url 'invoice' next.pk %}" class="btn">></a>
        {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 h4 text-center" align="center">
            Заявка № {{ info.id }}<br>{{ info.time_in }}

        </div>
   </div>

    <div class="row">
        <div class="col-md-12 h6 text-center" align="center">
                  {% if info.order_status == 'SND' %}
            <p align="center"><b id="stepstatuswork">Заявка направлена мастеру </b>  <br>
            <a href="../changestatus?order_pk={{ info.pk}}&work_status=RCV" id="workstatus"
               class="btn btn-md btn-orange" >ПРИНЯТЬ ЗАКАЗ</a><br>
            </p>
            {% endif %}

            {% if info.order_status == 'RCV' %}
            <p align="center"><b id="stepstatuswork">Заявка в работе</b><br>
                <a href="../changestatus?order_pk={{ info.pk}}&work_status=END" id="workstatus" class="btn btn-md btn-orange">Работы выполненны</a><br>
            </p>

            {% endif %}

            {% if info.order_status == 'END' %}
            <p align="center"><b id="stepstatuswork"><i class="fas fa-check-circle about-text"></i> Работы выполнены</b><br>
                <a href="pdf/{{ info.id }}" class="btn btn-md btn-orange">Квитанция на оплату - PDF</a>

            </p>


            {% endif %}

        </div>
   </div>
</div>


<div>
    <div class="row">
        <div class="col-md-4">
            Заказчик:
        </div>
        <div class="col-md-6">
            {{ info.customer_name }}
        </div>
        <div class="col-md-2" >
            <a href="../list_order/update/{{ info.pk}}" class="fas fa-pen text fa-sm mr-1 btn "></a>
        </div>
    </div>
     <div class="row">
        <div class="col-md-12">
            <hr>
        </div>
     </div>
    <div class="row">
        <div class="col-md-4">
            Адрес:
        </div>
        <div class="col-md-6">
            {{ info.address_city|choice_tag:'city' }}, {{ info.address_street_app }}, {{ info.address_num }}
        </div>
        <div class="col-md-2" >
            <a href= 'https://yandex.ru/maps/?pt={{ info.location_longitude|change_comma_to_dot }},
            {{ info.location_latitude|change_comma_to_dot }}&z=18&l=map' id="map_{{ i.pk }}"
            title="" class="fas fa-map-marker text fa-sm mr-1 btn">
            </a>
        </div>

    </div>
    <div class="row">
        <div class="col-md-12">
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            Телефон:
        </div>
        <div class="col-md-6" >
            {{ info.customer_phone }}
        </div>
        <div class="col-md-2" >
            <a href="tel:{{ info.customer_phone }}" title="Телефон" class="fas fa-phone text fa-sm mr-1 btn">
            </a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12"><hr></div>
    </div>
    <div class="row">
        <div class="col-md-4">
            Телеграм:
        </div>
        <div class="col-md-6">
            @{{ info.customer_telegram }}
        </div>
        <div class="col-md-2">
            <a href="https://t.me/{{ info.customer_telegram|cut:'@' }}" title="Телеграм" class="fas fa-paper-plane text fa-sm mr-1 btn">
            </a>
        </div>
    </div>
    <div class="row">
        <div class="col-md">
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
             Описание проблемы:
        </div>
        <div class="col-md-8">
            {{ info.text_order }}
        </div>
    </div>

    <div class="row">
        <div class="col-md">
            <hr>
        </div>
    </div>

{% if info.order_status == 'SND' %}
    <table id="table_invoice" class="hidden">
{% else %}
    <table id="table_invoice" class="table" >
{% endif %}
<thead>
<tr  class="table-warning">
    <th>Наименование </th>
    <th>Количество </th>
    <th>Цена</th>
    <th >Сумма</th>
    <th > </th>
</tr>
</thead>

<tr class="hidden">
    <td name="service_id"></td>
    <td name="quantity"></td>
    <td name="price"></td>
    <td name="amount">0</td>
    <td name="delete"><a href="" class="link-delete" ><img src="/media/images/delete.png" width="15" ></a></td>
</tr>

<tbody>
{% for g in invoice %}
    <tr class="form_text">
            <td name="service_id">{{ g.service_id }}</td>
            <td name="quantity">{{ g.quantity }} </td>
            <td name="price">{{ g.price }}</td>
            <td name="amount">{{ g.amount }}</td>
            <td name="delete"><a href="{% url 'delete-item-of-order' g.pk %}" class="link-delete" ><i class="fas fa-trash text-secondary"></i></a></td>
    </tr>
{% endfor %}
</tbody>
<tr class="table-warning" id="total_">
    <th>
    </th>

    <th class="h5-responsive" >
    </th>

    <th class="h5-responsive ">
        Итого:
    </th>

    <th class="h5-responsive" id="total">
    </th>

    <th>
    </th>
</tr>
<script>
    function sum_total() {
        let sum_total=0;
        $('td[name="amount"]').each(function(){sum_total += parseInt($(this).html());});
        $('#total').html(sum_total);
    }
    sum_total();
</script>

</table>

{% if info.order_status == 'SND' %}
<form action="" method="post" id="id_form" class="hidden">
{% else %}
<form action="" method="post" id="id_form" >
{% endif %}

    {% csrf_token %}
    <div id="form-list">
        <div id="empty-form" class="hidden">
            <a href="#" onclick="show_type_work(this)" class="btn btn-sm">открыть</a>
            <span class="type_work">
            {% for u in type_work %}
                <a href="../serv?type_work={{ u.0 }}" class="type_work btn btn-sm">{{ u.1 }}</a>
            {% endfor %}
            </span>
            <br> {{ form.empty_form }}<a href="#" id="delete-empty-form"><i class="fas fa-trash text-secondary"></i></a>
        </div>
        {{ form.management_form }}
    </div>
    <div id="error"></div>
    <div align="center">
        <button id="add-more" type="button" class="btn btn-md btn-orange">add-more</button>
        <button type="submit" class="btn btn-md btn-orange"> "Save" </button><br>
    </div>>

</form>


<script>

</script>
{% endblock body %}
{% extends 'flatpages/default_user.html' %}
{% load custom_filters %}
{% load custom_tags %}
{% load static %}
{% load slippers %}

{% block subbody %}



{% endblock subbody %}



{% block body %}


                    {% regroup clients by customer_id as customer %}

                            {% for i in customer %}


                <div  class="row" id="">
                    <div class="col-md-4">
                        <a href="{{ i.grouper.pk  }}" id="link" class="h5 mycolor" data-toggle="modal" data-target="#exampleModal">{{ i.grouper.customer_name }}</a><br>



                         <a href="tel:{{ i.grouper.phone }}" title="Phone" id="customer_phone_{{ i.pk }}" class="fas fa-phone prefix text-secondary mt-3" aria-hidden="true">
                            {{ i.grouper.phone }}</a><br>


                        <a href="https://t.me/{{ i.grouper.telegram|cut:'@' }}" title="Telegram" id="customer_id.telegram_{{ i.pk }}"
                           class ="fas fa fa-paper-plane text-secondary mt-3" aria-hidden="true">
                             @{{i.grouper.telegram}}</a><br>

                    </div>

                    <div class="col-md-4 ">
                         {% for b in i.list %}
                                          {% if b.apartment_id.location_longitude  %}
                    <a href= 'https://yandex.ru/maps/?pt={{ b.apartment_id.location_longitude|change_comma_to_dot }},
                    {{ b.apartment_id.location_latitude|change_comma_to_dot }}&z=18&l=map' id="map_{{ b.apartment_id.pk }}" class=" text-secondary mt-3"
                    title="Open map" aria-hidden="true" >
                    <i  class="fas fa-map-marker prefix text-secondary mt-3" aria-hidden="true"></i>
                    {% elif b.apartment_id.location_longitude is None %}
                        <a href="#" title="Copy address" class=" prefix text-secondary mt-3" aria-hidden="true" id="map_{{ b.pk }}" onclick="copyToClipboard($(this))">
                        <i class="fas fa-copy text-secondary mt-3"></i>

                    {% endif %}
                        <span id="city_{{ b.pk }}" >{{ b.apartment_id.address_city|choice_tag:'city'}}</span>,
                        <span id="street_app_{{ b.pk }}">{{ b.apartment_id.address_street_app|capfirst }}</span>,
                        <span id="num_{{ b.pk }}">{{ b.apartment_id.address_num }}</span>.
                    </a>
                    <hr>
                        {% endfor %}
                    </div>

            </div>

            <div class="row">
                <div class="col-md-12"><hr></div>
            </div>

                {% endfor %}



    <!-- Modal Window -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body  mx-3">
                    <div id="contact" class="form-container">
                        <fieldset>
                            <div id="message">
    				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                            </div>
                        </fieldset>
                            <div class="row">
                                <div class="col-6 text-center">
                                <h4 id="name" class="mycolor font-weight-bold"></h4>

                                    <img id="foto1" class="rounded-circle" align="" width="100">
                                </div>
                                <div class="col-6">
                                    <a href="tel:" title="Phone" id="customer_phone" class="fas fa-phone prefix text-secondary mt-3" aria-hidden="true">
                                    </a><br>
                                    <a href="https://t.me/" title="Telegram" id="customer_telegram" class ="fas fa fa-paper-plane text-secondary mt-3" aria-hidden="true">
                                    </a>
                                </div>
                            </div>
                            <div class="row h6 text-center" id="profile">
                            </div>

                            <div class="row" id="order1">Orders:
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- And Modal Window -->


<script>
$(document).on('click', '#link', function (e) {
    e.preventDefault();

         $.ajax({
            url: "../client?pk="+$(this).attr("href") ,
            type: "GET",
            dataType: 'json',

            success: function(resp){
            document.getElementById("name").innerHTML =resp.name;
            document.getElementById("customer_phone").innerHTML =' '+resp.phone;
            document.getElementById("customer_telegram").innerHTML = ' '+resp.telegram;
            document.getElementById("profile").innerHTML = resp.profile;
            document.getElementById("foto1").src ='../media/'+resp.foto;

            b=JSON.parse(resp.orders);


            let f=$('div[new="new"]');
                    for (i = 0; i < f.length; i++) {
                        f[i].remove();
                    }

            b.forEach((element, index ) =>  {
            let order_ = $("#order1").clone();
                order_.attr('id', 'order_'+element.pk);
                order_.attr('new', 'new');
                let date_order=element.time_in.substr(0, 10).split("-").reverse().join(".");
                order_.html('<a href=../list_order/' + element.pk + ' class="prefix text-secondary mb-2"> №'+element.pk+ ' | ' + date_order + ' | ' + element.text_order + '</a>');
                $('#order1').after(order_);

            }

            )}
        });





})

</script>>
profile






{% endblock body %}

